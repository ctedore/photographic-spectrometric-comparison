% This script:
% 1) calculates (or for the Nikon camera, loads) the spectral sensitivities you want to simulate
% 2) loads the 'realFilters.mat' file generated by 'realFilters_1.m', which contains the effective spectral sensitivity of each real filter (which accounts for all spectrally non-neutral camera components)
% 3) finds a set of coefficients (all contstrained to be >=0) that, when multiplied by the filters, provides the best fit to the desired spectral sensitivities (step 1 above)
% 4) outputs these coefficients in a .mat file 
% 5) plots the desired and effective spectral sensitivities on top of each other and saves this as a jpeg file.
% The user must uncomment the appropriate spectral sensitivities (lines 17-94) and associated optical media transmittance (OMT) curves (lines 152-175) for the animal they want to model. 
% The script should be run from within the '1 Computational Filters/' directory. The user must specify the directory above the working directory ('topDir' in line 12). 

clear 
close all
topDir = ''; % specify full path of directory above the '1 Computational Filters' directory
loadSens = 0;
realFiltersFilename = 'realFilters.mat'; % file generated by 'realFilters_1.mat' script
w = (270:780).';

%% SPECTRAL SENSITIVITIES YOU WANT TO SIMULATE: uncomment the appropriate one
% Nikon D7000 CoastalOpt 60mm 300-700 (sensitivities taken from MICA toolbox)
% animal = 'NikonD7000CoastalOpt60';
% loadSens = 1;
% sensFilename = 'NikonD7000CoastalOpt60_idealizedSens270-780.mat';
% statFiltsDir = [topDir, '2 Statistical Filters/']; % directory to save Nikon computational filter spectral sensitivity curves (for generating statistical filters)
% Clrs = [1 0 0; 0 1 0; 0 0 1; 0.8 0 1; 0 0 0];

% Habronattus pyrrithrix 
% animal = 'Habronattus';
% chromophore = 'a1';
% lambMax = [377 530 530]; % (Zurek et al. 2015)
% oMid = [NaN NaN NaN]; % oil droplet lambda_mid values you want to model
% oCut = [NaN NaN NaN]; % oil droplet lambda_cut values you want to model
% redFilter = [zeros(1,30) 0.00220458553791891	0.00196879073690673	0.00173299593589454	0.00149720113488235	0.00126140633387017	0.00102561153285798	0.000789816731845796	0.000554021930833610	0.000440917107583871	0.000440917107583871	0.000440917107583871	0.000440917107583871	0.000440917107583871	0.000440917107583871	0.000440917107583871	0.000440917107583871	0.000440917107583871	0.000708616780045468	0.00135424540186458	0.00199987402368369	0.00264550264550280	0.00329113126732191	0.00393675988914103	0.00458238851096014	0.00559082892416249	0.00685626102292793	0.00812169312169336	0.00938712522045880	0.0106525573192242	0.0125299193751577	0.0146604938271607	0.0167910682791637	0.0189216427311667	0.0208955804544041	0.0220121381886089	0.0231286959228137	0.0242452536570185	0.0253618113912233	0.0264783691254281	0.0268353174603176	0.0267384731670447	0.0266416288737718	0.0265447845804989	0.0263868220899472	0.0254546957671958	0.0245225694444445	0.0235904431216932	0.0226583167989419	0.0217261904761906	0.0208677799823634	0.0200203924162258	0.0191730048500882	0.0183256172839506	0.0174782297178131	0.0164210128495843	0.0152588813303099	0.0140967498110355	0.0129346182917611	0.0118235403323122	0.0111099508029332	0.0103963612735543	0.00968277174417528	0.00896918221479630	0.00825559268541732	0.00754200315603834	0.00738035113035123	0.00725709475709486	0.00713383838383849	0.00701058201058213	0.00688732563732576	0.00676406926406939	0.00664081289081302	0.00651755651755665	0.00639430014430028	0.00627104377104391	0.00614778739778754	0.00602453102453117	0.00590127465127480	0.00577801827801843	0.00587338330393901	0.00609935332157570	0.00632532333921239	0.00655129335684908	0.00677726337448577	0.00700323339212246	0.00722920340975915	0.00745517342739584	0.00768114344503252	0.00790711346266921	0.00847262305595657	0.00908890492223841	0.00970518678852026	0.0103214686548021	0.0109377505210839	0.0115540323873658	0.0121703142536476	0.0128711052322164	0.0136055077895356	0.0143399103468549	0.0150743129041741	0.0158087154614934	0.0165431180188126	0.0172775205761319	0.0180119231334511	0.0185714285714288	0.0191137566137568	0.0196560846560848	0.0201984126984129	0.0207206545169509	0.0206453311777387	0.0205700078385264	0.0204946844993142	0.0204193611601020	0.0203440378208897	0.0202475434618292	0.0200538548752835	0.0198601662887378	0.0196664777021921	0.0194727891156464	0.0192791005291007	0.0190854119425550	0.0187406729073397	0.0181149097815766	0.0174891466558135	0.0168633835300504	0.0162376204042872	0.0156118572785241	0.0149860941527610	0.0143603310269978	0.0137345679012347	0.0132085081797727	0.0126942315879099	0.0121799549960471	0.0116656784041843	0.0111514018123215	0.0106371252204587	0.0101228486285959	0.00960857203673310	0.00909429544487031	0.00850418871252218	0.00782627865961210	0.00714836860670203	0.00647045855379195	0.00579254850088188	0.00511463844797180	0.00443672839506173	0.00390841521793902	0.00371472663139329	0.00352103804484757	0.00332734945830185	0.00313366087175612	0.00293997228521040	0.00274628369866468	0.00255259511211895	0.00235890652557323	0.00215865667254561	0.00193268665490893	0.00170671663727225	0.00148074661963557	0.00125477660199890	0.00102880658436222	0.000802836566725543	0.000576866549088865	0.000350896531452187	0.000124926513815510	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	1.34192163178788e-05	7.23679165709249e-05	0.000131316616823971	0.000190265317077017	0.000249214017330063	0.000308162717583109	0.000367111417836155	0.000426060118089201	0.000547665459946255	0.000690383365822049	0.000833101271697844	0.000975819177573639	0.00111853708344943	0.00126125498932523	0.00180500440917110	0.00265239197530867	0.00349977954144625	0.00434716710758382	0.00519455467372140	0.00636967750062985	0.00811287477954143	0.00985607205845301	0.0115992693373646	0.0133424666162762	0.0161669606114050	0.0192401528512639	0.0223133450911228	0.0253865373309817	0.0284597295708406	0.0344813508393753	0.0407080802142529	0.0469348095891304	0.0531615389640080	0.0613139329805992	0.0710758377425037	0.0810670194003516	0.0929982363315686	0.104929453262786	0.116860670194002	0.131613756613755	0.146850592088686	0.162087427563617	0.180158730158729	0.201851851851851	0.223544973544973	0.245903479236811	0.268582651915984	0.291261824595156	0.314204585537917	0.339585537918870	0.364966490299822	0.390347442680775	0.415752765752765	0.441883116883117	0.468013468013468	0.494143819143820	0.518747795414463	0.541525573192241	0.564303350970019	0.587081128747796	0.609858906525574	0.632636684303351	0.651522122536615	0.669206732612530	0.686891342688444	0.704548408057180	0.721103685138773	0.737658962220366	0.754214239301960	0.766407203907204	0.778296703296703	0.790186202686202	0.802075702075701	0.812862181909800	0.823192239858906	0.833522297808012	0.842588758530787	0.848601525956598	0.854614293382409	0.860627060808220	0.865594356261023	0.869716049382716	0.873837742504409	0.877959435626103	0.882892416225750	0.888677248677249	0.894319131161236	0.897173489278752	0.900027847396269	0.902882205513785	0.904767195767196	0.906611111111111	0.908455026455027	0.910298941798942	0.915343915343915	0.920767195767196	0.923783587509078	0.926654735968461	0.929551244366059	0.932564177934549	0.937024439405392	0.942060342655581	0.947998914665581	0.955090896757563	0.961552028218695	0.966704144620811	0.971856261022927	0.976962081128748	0.981481481481481	0.986000881834215	0.990193075280794	0.992476561774807	0.994760048268820	0.996880511463845	0.996299445704208	0.995718379944571	0.995137314184933	0.994556248425296	0.994131393298060	0.993860229276896	0.993589065255732	0.993454585537919	0.993725749559083	0.993996913580247	repmat(0.994268077601411, [1 81])].';
% Clrs = [.64 0 0.8; 0 0.9 0; 1 0 0];
    
% humans
% animal = 'human';
% chromophore = 'a1';
% lambMax = [420 534 563]; % single cones MSP data from Bowmaker & Dartnall 1980
% oMid = [NaN NaN NaN]; % oil droplet lambda_mid values you want to model
% oCut = [NaN NaN NaN]; % oil droplet lambda_cut values you want to model
% Clrs = [0 0.6 1; 0 0.9 0; 1 0 0];

% U birds (Hart & Vorobyev 2005)
% animal = 'UVSbird';
% chromophore = 'a1';
% lambMax = [370 449 504 568];
% oMid = [NaN  427 526 588]; % oil droplet lambda_mid values you want to model
% oCut = [NaN  413 507 562]; % oil droplet lambda_cut values you want to model
% Clrs = [.8 0 1; 0 0.6 1; 0 0.9 0; 1 0 0; 0.4 0.4 0.4];

% V birds (Hart & Vorobyev 2005)
% animal = 'VSbird';
% chromophore = 'a1';
% lambMax = [409 449 504 568];
% oMid = [NaN  452 526 588]; % oil droplet lambda_mid values you want to model
% oCut = [NaN  433 507 562]; % oil droplet lambda_cut values you want to model
% Clrs = [.8 0 1; 0 0.6 1; 0 0.9 0; 1 0 0; 0.4 0.4 0.4];

% Podocarpis muralis (common wall lizard) (Martin et al. 2015)
% animal = 'Pmuralis';
% chromophore = 'a1';
% lambMax = [367 456 497 562];
% oMid = [NaN 429 500 470]; % oil droplet lambda_mid values you want to model
% oCut = (oMid-28.65) ./ 0.99; % if oCut unknown then use this equation
% Clrs = [.64 0 0.8; 0 0.48 .8; 0 0.9 0; 1 0 0; 0.4 0.4 0.4];
% subpl_y = 1;
% subpl_x = 1;
% outputFilename = 'Podocarpis_muralis';

% Ring-tailed lemur (Lemur catta) 
animal = 'Lcatta';
chromophore = 'a1';
% lambMax = [437 545]; % electrophys data (Jacobs & Deegan, 1993)
lambMax = [433 544]; % compensation for lens -> gets peak sensitivities to match those of electrophys data
oMid = [NaN NaN]; % oil droplet lambda_mid values you want to model
oCut = [NaN NaN]; % oil droplet lambda_cut values you want to model
Clrs = [0 0.48 .8; 0 0.9 0];

% Domestic dog (Canis lupus familiaris)
% animal = 'dog';
% chromophore = 'a1';
% % lambMax = [429 555]; % behavioral data (Neitz et al 1989)
% lambMax = [428 555]; % compensation for lens -> gets peak sensitivities to match those of behavioral data
% oMid = [NaN NaN]; % oil droplet lambda_mid values you want to model
% oCut = [NaN NaN]; % oil droplet lambda_cut values you want to model
% Clrs = [0 0.48 .8; 0 0.9 0];

% honeybee worker Apis mellifera (Briscoe & Chittka 2001, Peitsch et al. 1992)
% animal = 'honeybee';
% chromophore = 'a1';
% lambMax = [346 430 540];
% oMid = [NaN NaN NaN]; % oil droplet lambda_mid values you want to model
% oCut = [NaN NaN NaN]; % oil droplet lambda_cut values you want to model
% Clrs = [.8 0 1; 0 0.6 1; 0 0.9 0];

%% Optical media transmittance
% avian (Lind et al. 2013)
OMT_U = [zeros(1,30) 0.0418 0.0436	0.0490	0.0597	0.0762	0.0972	0.1157	0.1367	0.1600	0.1856	0.2136	0.2431	0.2733	0.3031	0.3309	0.3565	0.3789	0.3978	0.4142	0.4279	0.4395	0.4491	0.4573	0.4644	0.4708	0.4774	0.4834	0.4894	0.4952	0.5007	0.5066	0.5126	0.5185	0.5247	0.5313	0.5383	0.5455	0.5525	0.5596	0.5672	0.5750	0.5831	0.5911	0.5989	0.6064	0.6139	0.6210	0.6276	0.6349	0.6417	0.6478	0.6542	0.6605	0.6666	0.6723	0.6769	0.6803	0.6836	0.6875	0.6918	0.6971	0.7011	0.7042	0.7064	0.7090	0.7120	0.7162	0.7211	0.7259	0.7298	0.7326	0.7344	0.7376	0.7411	0.7446	0.7477	0.7505	0.7531	0.7555	0.7581	0.7608	0.7634	0.7659	0.7682	0.7704	0.7725	0.7745	0.7764	0.7787	0.7809	0.7827	0.7841	0.7858	0.7875	0.7892	0.7905	0.7921	0.7935	0.7950	0.7959	0.7969	0.7979	0.7991	0.7999	0.8004	0.8013	0.8024	0.8033	0.8041	0.8047	0.8054	0.8062	0.8073	0.8083	0.8095	0.8107	0.8117	0.8129	0.8139	0.8151	0.8165	0.8180	0.8196	0.8208	0.8219	0.8232	0.8246	0.8262	0.8279	0.8299	0.8320	0.8340	0.8358	0.8376	0.8397	0.8420	0.8441	0.8461	0.8475	0.8487	0.8496	0.8504	0.8512	0.8523	0.8534	0.8544	0.8549	0.8555	0.8561	0.8567	0.8574	0.8585	0.8598	0.8606	0.8612	0.8619	0.8626	0.8635	0.8640	0.8642	0.8651	0.8668	0.8683	0.8690	0.8698	0.8707	0.8719	0.8733	0.8747	0.8760	0.8772	0.8780	0.8781	0.8784	0.8798	0.8816	0.8836	0.8848	0.8855	0.8864	0.8877	0.8888	0.8899	0.8909	0.8914	0.8918	0.8928	0.8936	0.8941	0.8942	0.8949	0.8956	0.8968	0.8983	0.8996	0.9011	0.9022	0.9030	0.9034	0.9040	0.9055	0.9061	0.9063	0.9068	0.9073	0.9078	0.9084	0.9091	0.9098	0.9103	0.9111	0.9114	0.9124	0.9136	0.9144	0.9150	0.9156	0.9167	0.9171	0.9172	0.9177	0.9184	0.9190	0.9191	0.9199	0.9208	0.9211	0.9216	0.9217	0.9228	0.9231	0.9227	0.9231	0.9238	0.9245	0.9247	0.9249	0.9256	0.9257	0.9257	0.9252	0.9260	0.9275	0.9278	0.9276	0.9279	0.9280	0.9277	0.9278	0.9283	0.9292	0.9300	0.9304	0.9303	0.9302	0.9312	0.9324	0.9331	0.9342	0.9354	0.9358	0.9356	0.9357	0.9356	0.9353	0.9354	0.9353	0.9344	0.9343	0.9341	0.9337	0.9346	0.9360	0.9365	0.9372	0.9384	0.9394	0.9396	0.9406	0.9415	0.9421	0.9428	0.9433	0.9437	0.9448	0.9455	0.9458	0.9461	0.9465	0.9459	0.9459	0.9466	0.9472	0.9468	0.9459	0.9457	0.9461	0.9462	0.9464	0.9471	0.9491	0.9500	0.9502	0.9500	0.9504	0.9512	0.9511	0.9506	0.9512	0.9515	0.9516	0.9512	0.9507	0.9504	0.9513	0.9523	0.9532	0.9537	0.9543	0.9553	0.9562	0.9567	0.9567	0.9570	0.9581	0.9586	0.9588	0.9591	0.9602	0.9613	0.9616	0.9610	0.9606	0.9608	0.9613	0.9610	0.9610	0.9614	0.9620	0.9614	0.9605	0.9602	0.9613	0.9624	0.9631	0.9634	0.9642	0.9648	0.9650	0.9648	0.9655	0.9656	0.9659	0.9661	0.9657	0.9659	0.9665	0.9667	0.9666	0.9669	0.9666	0.9662	0.9666	0.9666	0.9665	0.9665	0.9665	0.9660	0.9655	0.9658	0.9665	0.9677	0.9683	0.9690	0.9688	0.9688	0.9694	0.9694	0.9697	0.9708	0.9715	0.9708	0.9702	0.9709	0.9713	0.9721	0.9729	0.9734	0.9742	0.9746	0.9748	0.9747	0.9751	0.9756	0.9755	0.9760	0.9763	0.9766	0.9777	0.9773	0.9787].';
OMT_V = [zeros(1, 30) 0.0404	0.0404	0.0411	0.0428	0.0457	0.0500	0.0554	0.0624	0.0706	0.0798	0.0899	0.1006	0.1116	0.1225	0.1332	0.1433	0.1530	0.1622	0.1708	0.1790	0.1868	0.1941	0.2012	0.2082	0.2153	0.2226	0.2302	0.2379	0.2460	0.2546	0.2637	0.2732	0.2832	0.2937	0.3047	0.3165	0.3286	0.3413	0.3541	0.3675	0.3812	0.3954	0.4095	0.4236	0.4375	0.4516	0.4657	0.4801	0.4944	0.5089	0.5226	0.5351	0.5466	0.5571	0.5667	0.5762	0.5855	0.5939	0.6013	0.6078	0.6136	0.6195	0.6255	0.6313	0.6370	0.6426	0.6470	0.6510	0.6551	0.6597	0.6652	0.6709	0.6760	0.6806	0.6852	0.6895	0.6937	0.6979	0.7018	0.7060	0.7100	0.7137	0.7172	0.7206	0.7240	0.7272	0.7304	0.7334	0.7362	0.7389	0.7413	0.7435	0.7456	0.7477	0.7498	0.7516	0.7536	0.7553	0.7569	0.7584	0.7599	0.7613	0.7626	0.7639	0.7651	0.7661	0.7669	0.7676	0.7683	0.7691	0.7699	0.7708	0.7716	0.7724	0.7733	0.7743	0.7756	0.7771	0.7788	0.7807	0.7827	0.7849	0.7874	0.7902	0.7932	0.7961	0.7990	0.8019	0.8047	0.8077	0.8106	0.8133	0.8161	0.8185	0.8208	0.8231	0.8253	0.8275	0.8296	0.8318	0.8340	0.8360	0.8379	0.8396	0.8414	0.8431	0.8448	0.8465	0.8481	0.8496	0.8510	0.8522	0.8534	0.8546	0.8560	0.8573	0.8587	0.8599	0.8612	0.8627	0.8641	0.8654	0.8664	0.8675	0.8688	0.8701	0.8711	0.8718	0.8725	0.8734	0.8740	0.8747	0.8756	0.8768	0.8775	0.8778	0.8780	0.8782	0.8783	0.8788	0.8794	0.8803	0.8811	0.8824	0.8840	0.8857	0.8874	0.8890	0.8907	0.8926	0.8943	0.8957	0.8971	0.8986	0.8998	0.9006	0.9013	0.9020	0.9027	0.9034	0.9039	0.9043	0.9049	0.9055	0.9059	0.9065	0.9070	0.9076	0.9083	0.9087	0.9091	0.9096	0.9102	0.9106	0.9108	0.9112	0.9115	0.9119	0.9119	0.9119	0.9119	0.9121	0.9124	0.9126	0.9130	0.9137	0.9142	0.9148	0.9157	0.9168	0.9181	0.9193	0.9202	0.9208	0.9215	0.9222	0.9228	0.9236	0.9243	0.9249	0.9255	0.9262	0.9271	0.9283	0.9295	0.9305	0.9313	0.9322	0.9330	0.9337	0.9343	0.9348	0.9353	0.9357	0.9358	0.9357	0.9358	0.9359	0.9358	0.9358	0.9358	0.9360	0.9362	0.9362	0.9363	0.9364	0.9367	0.9370	0.9373	0.9378	0.9385	0.9392	0.9401	0.9410	0.9420	0.9430	0.9440	0.9449	0.9457	0.9462	0.9465	0.9468	0.9471	0.9472	0.9473	0.9475	0.9477	0.9478	0.9479	0.9481	0.9485	0.9491	0.9498	0.9506	0.9513	0.9520	0.9526	0.9531	0.9535	0.9541	0.9546	0.9551	0.9558	0.9564	0.9574	0.9584	0.9592	0.9600	0.9609	0.9618	0.9626	0.9635	0.9640	0.9645	0.9649	0.9650	0.9650	0.9651	0.9653	0.9654	0.9655	0.9654	0.9653	0.9653	0.9654	0.9657	0.9662	0.9669	0.9676	0.9683	0.9690	0.9695	0.9699	0.9706	0.9713	0.9718	0.9721	0.9721	0.9721	0.9724	0.9725	0.9725	0.9728	0.9733	0.9734	0.9736	0.9737	0.9738	0.9739	0.9740	0.9741	0.9745	0.9749	0.9752	0.9754	0.9758	0.9763	0.9767	0.9770	0.9774	0.9780	0.9787	0.9792	0.9798	0.9805	0.9812	0.9814	0.9813	0.9813	0.9816	0.9819	0.9819	0.9818	0.9818	0.9820	0.9821	0.9822	0.9824	0.9828	0.9834	0.9839	0.9848	0.9858	0.9867	0.9873	0.9876	0.9874	0.9874	0.9873	0.9871	0.9868	0.9865	0.9864	0.9865	0.9867	0.9874	0.9882	0.9895	0.9905	0.9911	0.9915].';
OMT_mean = [zeros(1, 30)	0.0411 0.0420	0.0450	0.0512	0.0609	0.0736	0.0856	0.0995	0.1153	0.1327	0.1517	0.1718	0.1925	0.2128	0.2320	0.2499	0.2660	0.2800	0.2925	0.3034	0.3132	0.3216	0.3293	0.3363	0.3431	0.3500	0.3568	0.3636	0.3706	0.3777	0.3851	0.3929	0.4009	0.4092	0.4180	0.4274	0.4371	0.4469	0.4568	0.4673	0.4781	0.4893	0.5003	0.5112	0.5220	0.5327	0.5434	0.5538	0.5646	0.5753	0.5852	0.5946	0.6035	0.6118	0.6195	0.6266	0.6329	0.6387	0.6444	0.6498	0.6554	0.6603	0.6649	0.6689	0.6730	0.6773	0.6816	0.6861	0.6905	0.6948	0.6989	0.7027	0.7068	0.7109	0.7149	0.7186	0.7221	0.7255	0.7287	0.7320	0.7354	0.7385	0.7416	0.7444	0.7472	0.7498	0.7525	0.7549	0.7575	0.7599	0.7620	0.7638	0.7657	0.7676	0.7695	0.7711	0.7728	0.7744	0.7759	0.7772	0.7784	0.7796	0.7808	0.7819	0.7827	0.7837	0.7847	0.7854	0.7862	0.7869	0.7876	0.7885	0.7894	0.7904	0.7914	0.7925	0.7936	0.7950	0.7964	0.7979	0.7996	0.8014	0.8035	0.8055	0.8075	0.8096	0.8118	0.8141	0.8163	0.8188	0.8213	0.8237	0.8260	0.8281	0.8302	0.8325	0.8347	0.8368	0.8386	0.8402	0.8418	0.8432	0.8446	0.8460	0.8474	0.8487	0.8498	0.8510	0.8521	0.8532	0.8542	0.8554	0.8566	0.8576	0.8586	0.8596	0.8607	0.8617	0.8626	0.8635	0.8646	0.8661	0.8673	0.8683	0.8693	0.8704	0.8715	0.8725	0.8736	0.8747	0.8756	0.8763	0.8769	0.8776	0.8786	0.8797	0.8808	0.8815	0.8819	0.8826	0.8835	0.8845	0.8855	0.8866	0.8877	0.8887	0.8901	0.8913	0.8924	0.8934	0.8946	0.8956	0.8970	0.8985	0.8997	0.9008	0.9017	0.9025	0.9031	0.9037	0.9047	0.9052	0.9056	0.9061	0.9066	0.9071	0.9077	0.9084	0.9090	0.9095	0.9101	0.9105	0.9113	0.9121	0.9126	0.9131	0.9136	0.9143	0.9145	0.9145	0.9148	0.9153	0.9157	0.9159	0.9164	0.9172	0.9176	0.9182	0.9187	0.9198	0.9206	0.9210	0.9217	0.9223	0.9230	0.9235	0.9239	0.9246	0.9250	0.9253	0.9254	0.9261	0.9273	0.9280	0.9286	0.9292	0.9296	0.9300	0.9304	0.9310	0.9317	0.9324	0.9329	0.9330	0.9330	0.9335	0.9341	0.9345	0.9350	0.9356	0.9358	0.9358	0.9359	0.9359	0.9358	0.9359	0.9360	0.9357	0.9358	0.9360	0.9361	0.9369	0.9380	0.9388	0.9396	0.9407	0.9417	0.9423	0.9431	0.9438	0.9443	0.9448	0.9452	0.9455	0.9461	0.9465	0.9467	0.9470	0.9472	0.9470	0.9472	0.9479	0.9485	0.9487	0.9486	0.9488	0.9494	0.9496	0.9500	0.9506	0.9519	0.9526	0.9530	0.9532	0.9539	0.9548	0.9551	0.9553	0.9560	0.9567	0.9571	0.9573	0.9574	0.9575	0.9581	0.9587	0.9591	0.9594	0.9598	0.9604	0.9608	0.9610	0.9610	0.9612	0.9617	0.9621	0.9625	0.9630	0.9639	0.9648	0.9653	0.9653	0.9653	0.9657	0.9663	0.9664	0.9665	0.9667	0.9671	0.9669	0.9665	0.9664	0.9670	0.9678	0.9683	0.9685	0.9690	0.9693	0.9694	0.9694	0.9698	0.9700	0.9704	0.9707	0.9706	0.9708	0.9714	0.9717	0.9718	0.9722	0.9723	0.9724	0.9729	0.9732	0.9735	0.9738	0.9740	0.9736	0.9734	0.9737	0.9742	0.9748	0.9750	0.9754	0.9754	0.9754	0.9758	0.9759	0.9763	0.9771	0.9777	0.9778	0.9780	0.9788	0.9793	0.9798	0.9802	0.9804	0.9808	0.9808	0.9808	0.9806	0.9807	0.9810	0.9811	0.9817	0.9822	0.9831	0.9841	0.9842	0.9851].';
OMT_U = vertcat(OMT_U, ones(511-length(OMT_U), 1));
OMT_V = vertcat(OMT_V, ones(511-length(OMT_V), 1));
OMT_mean = vertcat(OMT_mean, ones(511-length(OMT_mean), 1));
% human lens data digitized from Turner & Mainster 2008, 10-year-old version
lens_human = [repmat(0, [1 31])	0.01	0.01	0.01	0.01	0.01	0.01	0.01	0.01	0.01	0.01	0.01	0.01	0.01	0.01	0.01	0.01	0.01	0.01	0.01	0.01	0.01	0.01	0.01	0.02	0.02	0.02	0.02	0.02	0.02	0.02	0.03	0.03	0.03	0.03	0.04	0.04	0.04	0.05	0.05	0.05	0.06	0.07	0.07	0.08	0.08	0.09	0.10	0.11	0.12	0.13	0.15	0.16	0.17	0.19	0.20	0.22	0.23	0.25	0.28	0.29	0.31	0.33	0.35	0.38	0.40	0.42	0.44	0.47	0.49	0.52	0.55	0.57	0.59	0.61	0.63	0.65	0.66	0.68	0.69	0.70	0.71	0.72	0.73	0.74	0.75	0.76	0.77	0.78	0.78	0.79	0.80	0.81	0.81	0.82	0.82	0.82	0.83	0.83	0.84	0.84	0.84	0.84	0.85	0.85	0.85	0.85	0.85	0.86	0.86	0.86	0.86	0.86	0.87	0.87	0.87	0.87	0.87	0.87	0.88	0.88	0.88	0.88	0.88	0.88	0.88	0.88	0.89	0.89	0.89	0.89	0.89	0.89	0.89	0.89	0.90	0.90	0.90	0.90	0.90	0.90	0.90	0.90	0.90	0.90	0.91	0.91	0.91	0.91	0.91	0.91	0.91	0.91	0.91	0.91	0.92	0.92	0.92	0.92	0.92	0.92	0.92	0.92	0.92	0.92	0.92	0.92	0.92	0.93	0.93	0.93	0.93	0.93	0.93	0.93	0.93	0.93	0.93	0.93	0.93	0.93	0.93	0.94	0.94	0.94	0.94	0.94	0.94	0.94	0.94	0.94	0.94	0.94	0.94	0.94	0.94	0.94	0.94	0.94	0.95	0.95	0.95	0.95	0.95	0.95	0.95	0.95	0.95	0.95	0.95	0.95	0.95	0.95	0.95	0.95	0.95	0.95	0.95	0.96	0.96	0.96	0.96	0.96	0.96	0.96	0.96	0.96	0.96	0.96	0.96	0.96	0.96	0.96	0.96	0.96	0.96	0.96	0.96	0.97	0.97	0.97	0.97	0.97	0.97	0.97	0.97	0.97	0.97	0.97	0.97	0.97	0.97	0.97	0.97	0.97	0.97	0.97	0.97	0.97	0.97	0.97	0.98	0.98	0.98	0.98	0.98	0.98	0.98	0.98	0.98	0.98	0.98	0.98	0.98	0.98	0.98	0.98	0.98	0.98	0.98	0.98	0.98	0.98	0.98	0.98	0.99	0.99	0.99	0.99	0.99	0.99	0.99	0.99	0.99	0.99	0.99	0.99	0.99	0.99	0.99	0.99	0.99	0.99	0.99	0.99	0.99	0.99	0.99	0.99	0.99	0.99	0.99	0.99	0.99	0.99	0.99	0.99	0.99	0.99	0.99	0.99	0.99	0.99	0.99	0.99	0.99	0.99	0.99	0.99	0.99	0.99	0.99	0.99	0.99	0.99	0.99	0.99	0.99	0.99	0.99	0.99	0.99	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00].';
lens_human = vertcat(zeros(50,1), lens_human, ones(80, 1));
% human cornea from equation fitted by van den Berg & Tan 1994
cornea_human = exp(-0.016 - 85e8 * w.^(-4));
OMT_human = lens_human .* cornea_human;
% Canis  lupus  familiaris (Douglas & Jeffery 2014)
Canis_lupus = [repmat(0.0000, [1 31])	0.0029	0.0066	0.0104	0.0141	0.0179	0.0216	0.0294	0.0373	0.0453	0.0532	0.0632	0.0887	0.1142	0.1544	0.1956	0.2369	0.2719	0.3049	0.3371	0.3680	0.3988	0.4107	0.4203	0.4298	0.4393	0.4488	0.4584	0.4674	0.4721	0.4769	0.4816	0.4864	0.4911	0.4959	0.5007	0.5054	0.5102	0.5149	0.5198	0.5248	0.5297	0.5347	0.5397	0.5447	0.5496	0.5546	0.5596	0.5646	0.5696	0.5745	0.5795	0.5845	0.5897	0.5951	0.6006	0.6061	0.6115	0.6170	0.6225	0.6279	0.6334	0.6388	0.6443	0.6498	0.6552	0.6607	0.6662	0.6716	0.6771	0.6823	0.6873	0.6923	0.6972	0.7022	0.7072	0.7122	0.7171	0.7221	0.7271	0.7321	0.7370	0.7420	0.7470	0.7515	0.7553	0.7592	0.7631	0.7670	0.7709	0.7748	0.7787	0.7825	0.7864	0.7903	0.7942	0.7981	0.8000	0.8017	0.8035	0.8052	0.8069	0.8087	0.8104	0.8121	0.8139	0.8156	0.8173	0.8191	0.8211	0.8233	0.8254	0.8275	0.8296	0.8318	0.8339	0.8360	0.8381	0.8403	0.8424	0.8445	0.8466	0.8487	0.8509	0.8530	0.8549	0.8566	0.8583	0.8600	0.8617	0.8634	0.8651	0.8667	0.8684	0.8701	0.8718	0.8735	0.8752	0.8769	0.8785	0.8798	0.8810	0.8822	0.8834	0.8846	0.8858	0.8870	0.8882	0.8894	0.8906	0.8918	0.8930	0.8942	0.8955	0.8967	0.8980	0.8993	0.9005	0.9018	0.9030	0.9043	0.9056	0.9068	0.9081	0.9093	0.9106	0.9118	0.9131	0.9144	0.9150	0.9156	0.9162	0.9168	0.9174	0.9180	0.9186	0.9192	0.9198	0.9204	0.9210	0.9217	0.9223	0.9229	0.9235	0.9241	0.9247	0.9253	0.9259	0.9265	0.9271	0.9277	0.9283	0.9289	0.9294	0.9295	0.9296	0.9298	0.9299	0.9301	0.9302	0.9304	0.9305	0.9307	0.9308	0.9309	0.9311	0.9312	0.9314	0.9315	0.9317	0.9318	0.9320	0.9321	0.9322	0.9324	0.9325	0.9327	0.9328	0.9332	0.9335	0.9338	0.9341	0.9344	0.9347	0.9350	0.9354	0.9357	0.9360	0.9363	0.9366	0.9369	0.9372	0.9376	0.9379	0.9382	0.9385	0.9388	0.9391	0.9394	0.9398	0.9399	0.9400	0.9402	0.9403	0.9405	0.9406	0.9407	0.9409	0.9410	0.9411	0.9413	0.9414	0.9415	0.9417	0.9418	0.9420	0.9421	0.9422	0.9424	0.9425	0.9426	0.9428	0.9429	0.9430	0.9432	0.9434	0.9439	0.9444	0.9449	0.9453	0.9458	0.9463	0.9468	0.9473	0.9478	0.9482	0.9487	0.9492	0.9497	0.9502	0.9506	0.9511	0.9516	0.9521	0.9526	0.9530	0.9535	0.9540	0.9543	0.9547	0.9551	0.9555	0.9558	0.9562	0.9566	0.9570	0.9573	0.9577	0.9581	0.9585	0.9588	0.9592	0.9596	0.9600	0.9604	0.9607	0.9611	0.9615	0.9619	0.9622	0.9626	0.9630	0.9633	0.9637	0.9640	0.9644	0.9648	0.9651	0.9655	0.9659	0.9662	0.9666	0.9669	0.9673	0.9677	0.9680	0.9684	0.9687	0.9691	0.9695	0.9699	0.9702	0.9706	0.9710	0.9714	0.9718	0.9722	0.9726	0.9730	0.9733	0.9737	0.9741	0.9745	0.9749	0.9753	0.9757	0.9760	0.9764	0.9768	0.9772	0.9776	0.9780	0.9784	0.9788	0.9791	0.9795	0.9799	0.9803	0.9807	0.9811	0.9815	0.9819	0.9822	0.9826	0.9828	0.9830	0.9832	0.9834	0.9836	0.9838	0.9840	0.9843	0.9845	0.9847	0.9849	0.9851	0.9853	0.9855	0.9857	0.9859	0.9861	0.9863	0.9865	0.9868	0.9870	0.9872	0.9874	0.9876	0.9878	0.9880	0.9882	0.9884	0.9886	0.9888	0.9891	0.9893	0.9895	0.9897	0.9899	0.9901	0.9903].';
Canis_lupus = vertcat(Canis_lupus, ones(511-length(Canis_lupus), 1));
% Podocarpis muralis (European wall lizard) (PÃ©rez i de Lanuza & Font 2014)
lens_Pmuralis = [zeros(1,30) 0.0148300000000000,0.0193562781556661,0.0238930641758887,0.0309406959227019,0.0450634852709743,0.0653466006099436,0.0924925699590471,0.124146527057929,0.155800484156810,0.188319102741095,0.219603883501687,0.250346847031650,0.278485963047173,0.303708063872388,0.330021297083054,0.356876637412729,0.378483013602238,0.393425467561107,0.404074544103873,0.413329676256578,0.421180201458792,0.428796618119490,0.434220142061951,0.439643666004412,0.444583387403259,0.449098587300634,0.453613787198010,0.458128987095385,0.462165024899202,0.465921832529312,0.469678640159421,0.473116536711645,0.475074518823543,0.477375930313790,0.480545283875567,0.483714637437344,0.486912729709617,0.490112539787253,0.493312349864888,0.496512159942523,0.499917368683944,0.503460635834660,0.507003902985376,0.510547170136092,0.514090437286808,0.517633704437524,0.520234518473010,0.522517652134264,0.527175313904601,0.531832975674939,0.535518469039535,0.537367712080902,0.539875785258156,0.543656970439758,0.547438155621359,0.551308956968252,0.554536149054415,0.555412264578925,0.556875549879799,0.563526888073268,0.567992384115346,0.572428435450619,0.576864486785892,0.579785328245413,0.584264571901463,0.590878165324267,0.597022529532996,0.597484959340365,0.598212273636210,0.602371285314274,0.606530296992338,0.610689308670402,0.612871042359901,0.615248240980313,0.619087557048299,0.626026566687931,0.630696941514235,0.632330603012642,0.636037859677626,0.639745116342609,0.643452373007593,0.647159629672577,0.650807877284664,0.652591097193250,0.655493631581379,0.659414262623517,0.661791627184401,0.663043101915104,0.664909181155188,0.668474441755746,0.670872906854614,0.674230604511013,0.678106563410726,0.680186872451535,0.682267181492344,0.684577252817513,0.687073430680597,0.689359818190730,0.690018804110589,0.687872214455254,0.685095968431606,0.685367242065468,0.687189345456689,0.690309206429850,0.692603069036116,0.693041162406343,0.694079735053571,0.697644995654129,0.700855794723240,0.703860169982238,0.704079886064526,0.702638730488183,0.701197574911841,0.699456832684592,0.697606319885245,0.696994896095009,0.696846240919210,0.696697585743413,0.700806348617499,0.707478915604136,0.711118402169484,0.716503416968780,0.726700451933341,0.736897486897902,0.746341272507980,0.753130270672016,0.755538902225383,0.758884258995414,0.765120370587188,0.761214517176879,0.756894554000000,0.756894554000000,0.759264126828439,0.761891618437178,0.761441165000000,0.761396193000000,0.763227386000000,0.766407382000000,0.771170525000000,0.774654011000000,0.774940883000000,0.773361639000000,0.773034935000000,0.779042680000000,0.785748868000000,0.792379921000000,0.795902999000000,0.796809900000000,0.801641386000000,0.807986136000000,0.812660161000000,0.815346399000000,0.811117388000000,0.802221590000000,0.794920322000000,0.789107427000000,0.787812736000000,0.793245159000000,0.800208658000000,0.804234178000000,0.804742398000000,0.805901170000000,0.811229555000000,0.828146619000000,0.829023332000000,0.824612467000000,0.819344061000000,0.817683394000000,0.819166338000000,0.820472359000000,0.821658529000000,0.823425802000000,0.819636437000000,0.817050657000000,0.816580165000000,0.816943963000000,0.818830466000000,0.816585761000000,0.808394496000000,0.814189562000000,0.838448587000000,0.858776743000000,0.874873124000000,0.870876606000000,0.869503900000000,0.878176792000000,0.888993585000000,0.881959555000000,0.864695870000000,0.859678217000000,0.867342674000000,0.866028126000000,0.850231131000000,0.835890200000000,0.826347375000000,0.826539429000000,0.824756529000000,0.816639406000000,0.818744835000000,0.823740755000000,0.831521771000000,0.839626179000000,0.840855883000000,0.840067172000000,0.836927159000000,0.835694869000000,0.836542266000000,0.842392548000000,0.850384281000000,0.857651265000000,0.863889197000000,0.869044491000000,0.872280038000000,0.864607230000000,0.859990800000000,0.852390206000000,0.845497750000000,0.843567292000000,0.839976699000000,0.837155769000000,0.836234704000000,0.836703730000000,0.837910612000000,0.838538424000000,0.842622397000000,0.862278328000000,0.869456833000000,0.891823378000000,0.899777904000000,0.902560664000000,0.911576746000000,0.919057394000000,0.928723243000000,0.915647496000000,0.904126166000000,0.900557640000000,0.897797465000000,0.890235835000000,0.882023777000000,0.885550578000000,0.891062850000000,0.898587764000000,0.896325386000000,0.901357019000000,0.905766442000000,0.917152664000000,0.917340563000000,0.905428029000000,0.899376388000000,0.894629045000000,0.899283536000000,0.902170235000000,0.897888593000000,0.893511358000000,0.896295644000000,0.901761768000000,0.907208544000000,0.906531469000000,0.904207625000000,0.902098997000000,0.900101931000000,0.896402655000000,0.893856377000000,0.892455948000000,0.890297086000000,0.888532636000000,0.884984427000000,0.882340448000000,0.881481137000000,0.889220344000000,0.897141635000000,0.897237931000000,0.897342504000000,0.897899485000000,0.902532855000000,0.911396207000000,0.915304622000000,0.917768530000000,0.918975349000000,0.918899976000000,0.919425589000000,0.916154190000000,0.915043228000000,0.913833175000000,0.914397557000000,0.913838565000000,0.913805599000000,0.914420651000000,0.915978609000000,0.916114825000000,0.911556208000000,0.908463651000000,0.902256033000000,0.900852807000000,0.901438080000000,0.904035674000000,0.910058575000000,0.914988939000000,0.917178430000000,0.918032271000000,0.918963903000000,0.918859620000000,0.917038482000000,0.919205456000000,0.922278224000000,0.919948752000000,0.934287054000000,0.940376898000000,0.947717405000000,0.951053731000000,0.949807982000000,0.946913105000000,0.957436104000000,0.961523585000000,0.961119783000000,0.956544500000000,0.948638731000000,0.946445560000000,0.946405348000000,0.947023154000000,0.947624721000000,0.947119545000000,0.942714416000000,0.936505674000000,0.932479228000000,0.937773620000000,0.942445275000000,0.946472149000000,0.953275667000000,0.964165366000000,0.968106576000000,0.968420173000000,0.966330337000000,0.966143716000000,0.966142998000000,0.966147637000000,0.968784486000000,0.971779274000000,0.975389059000000,0.978927436000000,0.980562206000000,0.977491565000000,0.975337586000000,0.973776340000000,0.971220336000000,0.970314831000000,0.969512420000000,0.969474177000000,0.965304222000000,0.964021370000000,0.966678015000000,0.968105762000000,0.968828072000000,0.967456988000000,0.964475696000000,0.963554716000000,0.960578734000000,0.963978037000000,0.965510034000000,0.969094605000000,0.970737846000000,0.982625109000000,0.988003248000000,0.993741056000000,0.990346838000000,0.976325736000000,0.973320077000000,0.971806431000000,0.973785878000000,0.978831266000000,0.980776793000000,0.978612348000000,0.978516657000000,0.978490683000000,0.970181936000000,0.965267058000000,0.963107988000000,0.957733458000000,0.959485622000000,0.963846067000000,0.968836268000000,0.975672235000000,0.977070488000000,0.978542207000000,0.979065044000000,0.981009770000000,0.981528854000000,0.981879617000000,0.982444732000000,0.982451514000000,0.982452842000000,0.982352939000000,0.972298446000000,0.959750156000000,0.945096473000000,0.930220986000000,0.934036643000000,0.941206383000000,0.959969028000000,0.965741959000000,0.971490291000000].';
lens_Pmuralis = vertcat(lens_Pmuralis, repmat(lens_Pmuralis(end), length(w)-length(lens_Pmuralis), 1));
% Lemur catta lens (Douglas & Jeffery 2014)
Lcatta_lens = [zeros(1, 30) 0.000414765657403393	0.000354515488222690	0.000294265319041986	0.000234015149861283	0.000173764980680580	0.000113514811499876	5.32646423191729e-05	5.54420929390010e-05	0.000533630144537912	0.00101181819613682	0.00149000624773573	0.00196819429933464	0.00244638235093356	0.00292457040253247	0.00340275845413138	0.00388094650573029	0.00435913455732920	0.00478532532344996	0.00517306431543562	0.00556080330742128	0.00594854229940694	0.00633628129139260	0.00672402028337825	0.00711175927536391	0.00749949826734957	0.00788723725933523	0.00827497625132089	0.00866271524330655	0.00905045423529221	0.00943819322727786	0.00982593221926352	0.0102136712112492	0.0105977233973912	0.0109793078022025	0.0113608922070137	0.0117424766118250	0.0121240610166363	0.0125056454214475	0.0128872298262588	0.0132688142310700	0.0136503986358813	0.0140319830406925	0.0144135674455038	0.0147951518503151	0.0151767362551263	0.0154343872635032	0.0155928915547325	0.0157513958459618	0.0159099001371911	0.0160684044284204	0.0162269087196497	0.0163854130108790	0.0165439173021083	0.0167024215933376	0.0168609258845669	0.0170194301757962	0.0171779344670255	0.0173364387582548	0.0174949430494841	0.0176534473407134	0.0178119516319427	0.0180446761865255	0.0182899804467614	0.0185352847069973	0.0187805889672332	0.0190258932274691	0.0195495644960595	0.0201505599336373	0.0207515553712151	0.0213525508087929	0.0219535462463707	0.0237128845731573	0.0255310220313757	0.0273491594895942	0.0291672969478126	0.0315221899626710	0.0339752325650293	0.0364282751673876	0.0399155386297652	0.0445986199615400	0.0492817012933148	0.0557279137287432	0.0625964330153463	0.0717433983132863	0.0809014240287571	0.0923268353380342	0.106425374926325	0.121066224249966	0.138466473109360	0.155866721968755	0.173266970828149	0.190667219687544	0.208067468546938	0.229172353983636	0.251651144376155	0.274129934768675	0.296608725161194	0.319087515553713	0.342146906045704	0.366023187375323	0.389899468704943	0.410801041673749	0.431294000856729	0.451786960039709	0.472279919222689	0.492772878405669	0.513265837588649	0.533758796771628	0.551210918212163	0.565765637652822	0.580320357093481	0.594875076534139	0.609429795974798	0.622954053182174	0.635164754136135	0.646462970643809	0.655239411954468	0.664065888487290	0.673387450376252	0.681126719924982	0.686502082844932	0.691877445764882	0.698183326420573	0.705051845707176	0.713745333886355	0.722679100101546	0.727416009954376	0.732152919807206	0.736889829660036	0.741574771544400	0.746227639448228	0.750880507352056	0.755533375255884	0.759454352735149	0.763270196783262	0.767086040831375	0.770901884879488	0.774114936172174	0.776786027005853	0.779457117839532	0.782128208673211	0.784743882206553	0.787104935711323	0.789465989216093	0.791827042720863	0.794188096225633	0.796549149730402	0.798910203235172	0.801271256739942	0.803497304023227	0.805557859809208	0.807618415595189	0.809678971381170	0.811739527167151	0.813800082953131	0.815860638739112	0.817895064288677	0.819826835338034	0.821758606387391	0.823690377436748	0.825580126176079	0.827387631251501	0.829195136326923	0.831002641402345	0.832810146477766	0.834725312016892	0.836676595905132	0.838627879793371	0.840579163681611	0.842530447569850	0.844342596433015	0.845973869763584	0.847605143094152	0.849236416424720	0.850867689755288	0.852550808793032	0.854267938614683	0.855985068436334	0.857702198257984	0.859419328079635	0.861136457901286	0.862853587722937	0.864570717544588	0.866287847366238	0.868004977187889	0.869742313541567	0.871503472333004	0.873264631124441	0.875025789915877	0.876786948707314	0.878548107498751	0.880309266290187	0.882070425081624	0.883831583873061	0.885574898830809	0.886874348425572	0.888173798020335	0.889473247615098	0.890772697209860	0.892072146804623	0.893371596399386	0.894671045994149	0.895970495588911	0.897243448149470	0.898281712692794	0.899319977236118	0.900358241779441	0.901396506322765	0.902434770866089	0.903473035409412	0.904511299952736	0.905549564496060	0.906587829039384	0.907626093582707	0.908714092666676	0.909821918358063	0.910929744049451	0.912037569740839	0.913145395432226	0.914253221123614	0.915361046815001	0.916455597032121	0.917504954145352	0.918554311258583	0.919603668371814	0.920653025485046	0.921702382598277	0.922751739711508	0.923801096824739	0.924850453937970	0.925893916448835	0.926932180992158	0.927970445535482	0.929008710078806	0.930046974622129	0.931085239165453	0.932123503708777	0.933161768252101	0.934200032795424	0.935238297338748	0.936211065138441	0.936797402150712	0.937383739162983	0.937970076175254	0.938556413187525	0.939142750199796	0.939729087212067	0.940315424224338	0.940901761236609	0.941488098248880	0.942117148255680	0.942880317065303	0.943643485874925	0.944406654684548	0.945169823494170	0.945932992303793	0.946696161113416	0.947459329923038	0.948222498732661	0.948881515277202	0.949453891884419	0.950026268491636	0.950598645098853	0.951171021706070	0.951743398313286	0.952315774920503	0.952888151527720	0.953460528134937	0.954145210520159	0.954849674036734	0.955554137553308	0.956258601069883	0.956963064586458	0.957667528103032	0.958371991619607	0.959076455136181	0.959780918652756	0.960447521509322	0.961063927086325	0.961680332663327	0.962296738240330	0.962913143817333	0.963529549394336	0.964145954971339	0.964762360548342	0.965378766125344	0.965994095688877	0.966499133871715	0.967004172054554	0.967509210237393	0.968014248420231	0.968519286603069	0.969024324785908	0.969529362968746	0.970034401151585	0.970468685192866	0.970884959089024	0.971301232985182	0.971717506881340	0.972133780777497	0.972550054673655	0.972966328569813	0.973382602465971	0.973941340285596	0.974530070510162	0.975118800734728	0.975707530959294	0.976296261183860	0.976884991408426	0.977473721632992	0.978062451857558	0.978645098852482	0.979217475459699	0.979789852066916	0.980362228674133	0.980934605281350	0.981506981888566	0.982079358495783	0.982651735103000	0.983224111710217	0.983796488317434	0.984330641422890	0.984734671969161	0.985138702515432	0.985542733061703	0.985946763607974	0.986350794154244	0.986754824700515	0.987158855246786	0.987563251762754	0.987992534218167	0.988421816673580	0.988851099128992	0.989280381584405	0.989709664039818	0.990138946495230	0.990568228950643	0.990960272663337	0.991258903936667	0.991557535209998	0.991856166483328	0.992154797756659	0.992453429029990	0.992892101676838	0.993382710197310	0.993873318717782	0.994363927238253	0.994854535758725	0.995345144279197	0.995835752799668	0.996153991176804	0.996466196598922	0.996778402021040	0.997090607443158	0.997402812865277	0.997654367835365	0.997873575897703	0.998092783960041	0.998311992022380	0.998531200084718	0.998750408147057	0.998969616209395	0.999188824271734	0.999408032334072	0.999627240396410	0.999846448458749	1.00000000000000	1.00000000000000	1.00000000000000	1.00000000000000	1.00000000000000	1.00000000000000	1.00000000000000	1.00000000000000	1.00000000000000	1.00000000000000	1.00000000000000	1.00000000000000	1.00000000000000	1.00000000000000	1.00000000000000	1.00000000000000	1.00000000000000	1.00000000000000	1.00000000000000	1.00000000000000	1.00000000000000	1.00000000000000	1.00000000000000	1.00000000000000	1.00000000000000	1.00000000000000	1.00000000000000	1.00000000000000	1.00000000000000	1.00000000000000	1.00000000000000	1.00000000000000	1.00000000000000	1.00000000000000	1.00000000000000  ones(1, 80)].';
% Habronattus pyrrithrix (Zurek et al. 2015)
OMT_Habronattus = [zeros(1,30) 0.2017	0.2157	0.2300	0.2417	0.2552	0.2655	0.2736	0.2797	0.2870	0.2931	0.2973	0.3023	0.3068	0.3087	0.3113	0.3144	0.3175	0.3196	0.3216	0.3249	0.3288	0.3306	0.3325	0.3357	0.3390	0.3419	0.3454	0.3497	0.3529	0.3554	0.3590	0.3634	0.3657	0.3684	0.3731	0.3770	0.3805	0.3836	0.3875	0.3921	0.3953	0.3999	0.4041	0.4076	0.4112	0.4160	0.4211	0.4238	0.4263	0.4302	0.4342	0.4373	0.4406	0.4453	0.4499	0.4531	0.4567	0.4594	0.4618	0.4638	0.4665	0.4711	0.4742	0.4766	0.4794	0.4824	0.4853	0.4882	0.4913	0.4946	0.4976	0.5006	0.5033	0.5050	0.5069	0.5091	0.5115	0.5140	0.5168	0.5200	0.5224	0.5249	0.5279	0.5312	0.5344	0.5358	0.5380	0.5410	0.5433	0.5469	0.5503	0.5524	0.5555	0.5578	0.5610	0.5638	0.5661	0.5695	0.5726	0.5747	0.5776	0.5807	0.5830	0.5859	0.5894	0.5910	0.5924	0.5943	0.5963	0.5991	0.6021	0.6040	0.6070	0.6087	0.6099	0.6129	0.6153	0.6174	0.6197	0.6230	0.6258	0.6275	0.6308	0.6337	0.6362	0.6402	0.6439	0.6460	0.6478	0.6504	0.6528	0.6547	0.6568	0.6597	0.6616	0.6635	0.6664	0.6691	0.6711	0.6733	0.6745	0.6761	0.6779	0.6801	0.6830	0.6842	0.6856	0.6883	0.6906	0.6926	0.6952	0.6969	0.6977	0.6993	0.7017	0.7030	0.7043	0.7069	0.7098	0.7124	0.7154	0.7172	0.7187	0.7199	0.7220	0.7251	0.7268	0.7288	0.7300	0.7305	0.7311	0.7335	0.7370	0.7390	0.7423	0.7444	0.7452	0.7466	0.7484	0.7502	0.7516	0.7539	0.7564	0.7584	0.7607	0.7629	0.7638	0.7645	0.7651	0.7666	0.7686	0.7695	0.7710	0.7731	0.7743	0.7756	0.7772	0.7794	0.7821	0.7837	0.7851	0.7860	0.7867	0.7881	0.7893	0.7901	0.7919	0.7929	0.7940	0.7963	0.7978	0.7982	0.7986	0.7990	0.7998	0.8025	0.8054	0.8070	0.8083	0.8097	0.8105	0.8122	0.8139	0.8142	0.8147	0.8160	0.8178	0.8203	0.8229	0.8249	0.8260	0.8272	0.8281	0.8277	0.8283	0.8300	0.8323	0.8343	0.8356	0.8373	0.8387	0.8392	0.8391	0.8394	0.8395	0.8388	0.8387	0.8393	0.8398	0.8420	0.8433	0.8434	0.8437	0.8436	0.8443	0.8434	0.8431	0.8431	0.8429	0.8442	0.8451	0.8453	0.8457	0.8464	0.8475	0.8482	0.8485	0.8494	0.8501	0.8495	0.8500	0.8510	0.8524	0.8530	0.8531	0.8518	0.8513	0.8513	0.8518	0.8532	0.8551	0.8563	0.8582	0.8603	0.8612	0.8632	0.8645	0.8640	0.8625	0.8615	0.8614	0.8608	0.8611	0.8615	0.8617	0.8609	0.8605	0.8613	0.8625	0.8634	0.8636	0.8633	0.8630	0.8635	0.8641	0.8630	0.8617	0.8609	0.8597	0.8603	0.8614	0.8607	0.8588	0.8577	0.8552	0.8528	0.8520	0.8527	0.8545	0.8554	0.8562	0.8563	0.8566	0.8582	0.8602	0.8612	0.8623	0.8644	0.8660	0.8671	0.8669	0.8668	0.8670	0.8679	0.8703	0.8712	0.8722	0.8727	0.8735	0.8761	0.8800	0.8809	0.8808	0.8792	0.8776	0.8766	0.8756	0.8759	0.8762	0.8763	0.8774	0.8784	0.8807	0.8830	0.8854	0.8902	0.8943	0.8957	0.8958	0.8961	0.8973	0.9000	0.9015	0.9015	0.9007	0.9009	0.9026	0.9038	0.9053	0.9069	0.9077	0.9079	0.9073	0.9072	0.9076	0.9072	0.9063	0.9051	0.9031	0.9017	0.8997	0.8988	0.8996	0.9004	0.9017	0.9028	0.9037	0.9029	0.9017	0.9000	0.8987	0.8990	0.8997	0.9005	0.9016	0.9038	0.9054	0.9055	0.9050	0.9052	0.9055	0.9083	0.9125	0.9135	0.9142	0.9141	0.9130	0.9127	0.9138	0.9148	0.9192	0.9246	0.9273	0.9310	0.9330	0.9337	0.9357	0.9385	0.9399	0.9422	0.9443	0.9460	0.9506	0.9560	0.9599	0.9633	0.9647	0.9647	0.9641	0.9645	0.9647	0.9675	0.9694	0.9696	0.9703	0.9709	0.9722	0.9754	0.9798	0.9823	0.9840	0.9848	0.9858	0.9856	0.9868	0.9878	0.9884	0.9887	0.9890	0.9894	0.9903	0.9908	0.9907	0.9915	0.9924	0.9917	0.9911	0.9905	0.9889	0.9860	0.9837	0.9813	0.9800	0.9802	0.9806	0.9830	0.9850	0.9879	0.9895	0.9892	0.9884	0.9876	0.9880	0.9891	0.9899	0.9893	0.9855	0.9813	0.9791	0.9780	0.9793].';

%%
load(realFiltersFilename) 
filters = filters(1:511,:); % cuts off spectra above 780 nm where IR blocking filter effectively blocks all light
numFilters = size(filters,2);

if loadSens == 1
    load(sensFilename);
else
    %% OPSIN TEMPLATE
    vpig = zeros(length(w), length(lambMax));
    for i = 1:length(lambMax)
        S = lambMax(i);
        if strcmp(chromophore, 'a1')
            a = 0.8795 + 0.0459 * exp(-((S - 300)^2) / 11940);
            b = -40.5 + 0.195 * S;
        elseif strcmp(chromophore, 'a2')
            a = 0.875 + 0.0268 * exp((S - 665) / 40.7);
            b = 317 - 1.149 * S + 0.00124 * (S^2);
        end
        alpha = 1./ (exp(69.7 .* (a - S./w)) + exp(28 .* (0.922 - (S ./ w))) + exp(-14.9 .* (1.104 - (S ./ w))) + 0.674);
        beta = 0.26 .* exp(-(((w - (189 + 0.315 .* S)) ./ b).^2));
        opsin = alpha + beta;
        if isnan(oMid(i))
            vpig(:,i) = opsin;
        else
            oil = exp(-2.93 .* exp(-2.89 .* (0.5./(oMid(i)-oCut(i))) .* (w-oCut(i))));
            vpig(:,i) = opsin .* oil;
        end
        if strcmp(animal, 'Habronattus') && i == 3
            vpig(:,i) = vpig(:,i) .* redFilter;
        end
    
        %% OPTICAL MEDIA TRANSMITTANCE (OMT): uncomment appropriate one
        % humans
        % vpig(:,i) = vpig(:,i) .* OMT_human;
    
        % birds
        % if lambMax(1) == 370 && i <= 2
        %     vpig(:,i) = vpig(:,i) .* OMT_U;
        % elseif lambMax(1) == 409 && i <= 2
        %     vpig(:,i) = vpig(:,i) .* OMT_V;
        % else
        %     vpig(:,i) = vpig(:,i) .* OMT_mean;
        % end
        
        % Canis lupus familiaris
        % vpig(:,i) = vpig(:,i) .* Canis_lupus;
    
        % Podocarpis muralis
        % vpig(:,i) = vpig(:,i) .* lens_Pmuralis; 
    
        % Lemur catta
         vpig(:,i) = vpig(:,i) .* Lcatta_lens;
    
        % Habronattus spiders
        % vpig(:,i) = vpig(:,i) .* OMT_Habronattus; 
    end
end

%% area normalize
vpig = vpig ./ sum(vpig);

%% GENERATE COMPUTATIONAL FILTERS, PLOT RESULT
options = optimoptions(@lsqlin, 'Algorithm', 'interior-point'); % 'interior-point' is default algorithm
iter = 1;
figure
for i = 1:size(vpig,2)
    coeff = lsqlin(filters, vpig(:,i), [], [], [], [], zeros(1,numFilters), [], [], options);
    coeffSet(:,iter) = coeff;
    synthOp(:,i) = sum(filters .* coeffSet(:,iter).', 2);
    plot(w, vpig(:,i), 'Color', Clrs(i,:), 'LineWidth', 2)
    hold on
    plot(w,synthOp(:,i), ':', 'Color', Clrs(i,:), 'LineWidth', 2)
    yticks([])
    iter = iter + 1;
end
xlabel('wavelength (nm)')
set(gcf, 'Position', [1 1 585 346])  
xlim([290 715])
savefig([animal, 'ComputFilters', '.fig'])
print([animal, 'ComputFilters', '.jpeg'], '-r600', '-djpeg')

%% SAVE COEFFICIENTS
save([animal, 'ComputFilterCoeffs', '.mat'], 'coeffSet') % saves coefficients

%% SAVE SPECTRAL SENSITIVITIES
if strcmp(animal, 'NikonD7000CoastalOpt60')
    computNikon = synthOp(31:end, :);
    save([statFiltsDir, 'computNikonSens300-780.mat'], 'computNikon', '-mat') % saves computational sensitivity curves of virtual Nikon filters 
else
    idealizedSens = vpig(31:end, :);
    save([topDir, animal, '_idealizedSens300-780.mat'], 'idealizedSens', '-mat') % saves target sensitivity curves of photoreceptors
end